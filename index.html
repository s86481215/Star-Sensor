<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>星點座標測量工具</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a2e;
            color: white;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .upload-area {
            border: 2px dashed #4a90e2;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .upload-area:hover {
            background-color: rgba(74, 144, 226, 0.1);
        }
        
        .image-container {
            position: relative;
            display: inline-block;
            margin-bottom: 20px;
        }
        
        .constellation-image {
            max-width: 100%;
            border: 1px solid #444;
            cursor: crosshair;
        }
        
        .star-marker {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #ff6b6b;
            border: 2px solid white;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            cursor: pointer;
        }
        
        .coordinates-panel {
            background: #2d2d44;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .coordinate-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #444;
        }
        
        .coordinate-item:last-child {
            border-bottom: none;
        }
        
        .delete-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .delete-btn:hover {
            background: #c0392b;
        }
        
        .export-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .export-btn:hover {
            background: #219a52;
        }
        
        .instructions {
            background: #2d2d44;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .clear-btn {
            background: #f39c12;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
            margin-left: 10px;
        }
        
        .clear-btn:hover {
            background: #e67e22;
        }
        
        .conversion-panel {
            background: #2d2d44;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            border: 2px solid #4a90e2;
        }
        
        .coordinate-display {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }
        
        .coord-section {
            background: #1a1a2e;
            padding: 15px;
            border-radius: 8px;
        }
        
        .coord-section h4 {
            margin-top: 0;
            color: #4a90e2;
        }
        
        .coord-item {
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin: 5px 0;
            padding: 5px;
            background: rgba(74, 144, 226, 0.1);
            border-radius: 4px;
        }
        
        .image-info {
            background: #2d2d44;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            text-align: center;
        }
        
        .copy-btn {
            background: #8e44ad;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 12px;
        }
        
        .copy-btn:hover {
            background: #732d91;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🌟 星點座標測量工具</h1>
        
        <div class="instructions">
            <h3>使用方法：</h3>
            <ol>
                <li>點擊下方區域上傳你的星座 PNG 圖片</li>
                <li>在圖片上點擊每個星星的位置</li>
                <li>座標會自動記錄在下方</li>
                <li>點擊「導出座標」複製結果</li>
            </ol>
        </div>
        
        <div class="upload-area" id="uploadArea">
            <p>📁點擊這裡上傳星座圖片 (PNG, JPG, GIF)</p>
            <input type="file" id="imageInput" accept="image/*" style="display: none;">
        </div>
        
        <div id="imageContainer" class="image-container" style="display: none;">
            <img id="constellationImage" class="constellation-image">
        </div>
        
        <div class="coordinates-panel">
            <h3>📍 星點座標記錄：</h3>
            <div id="coordinatesList"></div>
            <button class="export-btn" id="exportBtn">導出座標</button>
            <button class="clear-btn" id="clearBtn">清除所有</button>
        </div>
        
        <div class="conversion-panel" id="conversionPanel" style="display: none;">
            <h3>🔄 座標轉換結果</h3>
            <div class="image-info" id="imageInfo"></div>
            <div class="coordinate-display">
                <div class="coord-section">
                    <h4>📐 像素座標 (px)</h4>
                    <div id="pixelCoords"></div>
                    <button class="copy-btn" onclick="copyPixelCoords()">複製像素座標</button>
                </div>
                <div class="coord-section">
                    <h4>📊 星座格式數據</h4>
                    <div id="percentCoords"></div>
                    <button class="copy-btn" onclick="copyPercentCoords()">複製星座格式</button>
                </div>
            </div>
            <div style="margin-top: 20px;">
                <button class="copy-btn" onclick="copyCustomFormat()" style="background: #e67e22;">複製完整星座數據</button>
                <button class="copy-btn" onclick="copyCSSCode()" style="background: #27ae60;">複製 CSS 代碼</button>
                <button class="copy-btn" onclick="copyJavaScriptCode()" style="background: #f1c40f; color: #2c3e50;">複製 JavaScript 代碼</button>
            </div>
        </div>
    </div>

    <script>
        let starCount = 0;
        let coordinates = [];
        let imageWidth = 0;
        let imageHeight = 0;
        
        const uploadArea = document.getElementById('uploadArea');
        const imageInput = document.getElementById('imageInput');
        const imageContainer = document.getElementById('imageContainer');
        const constellationImage = document.getElementById('constellationImage');
        const coordinatesList = document.getElementById('coordinatesList');
        const exportBtn = document.getElementById('exportBtn');
        const clearBtn = document.getElementById('clearBtn');
        const conversionPanel = document.getElementById('conversionPanel');
        const imageInfo = document.getElementById('imageInfo');
        const pixelCoords = document.getElementById('pixelCoords');
        const percentCoords = document.getElementById('percentCoords');
        
        // 點擊上傳區域
        uploadArea.addEventListener('click', () => {
            imageInput.click();
        });
        
        // 處理文件上傳
        imageInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    constellationImage.src = e.target.result;
                    imageContainer.style.display = 'inline-block';
                    uploadArea.style.display = 'none';
                    
                    // 獲取圖片尺寸
                    constellationImage.onload = () => {
                        imageWidth = constellationImage.naturalWidth;
                        imageHeight = constellationImage.naturalHeight;
                        updateImageInfo();
                    };
                };
                reader.readAsDataURL(file);
            }
        });
        
        // 更新圖片信息
        function updateImageInfo() {
            imageInfo.innerHTML = `
                <strong>圖片尺寸：</strong> ${imageWidth} × ${imageHeight} 像素<br>
                <small>座標將自動轉換為相對百分比，適應任何尺寸顯示</small>
            `;
        }
        
        // 點擊圖片記錄座標
        constellationImage.addEventListener('click', (e) => {
            const rect = constellationImage.getBoundingClientRect();
            const x = Math.round(e.clientX - rect.left);
            const y = Math.round(e.clientY - rect.top);
            
            // 計算實際像素座標（基於原圖尺寸）
            const actualX = Math.round((x / rect.width) * imageWidth);
            const actualY = Math.round((y / rect.height) * imageHeight);
            
            starCount++;
            const starData = { 
                id: starCount, 
                x: actualX, 
                y: actualY, 
                displayX: x,  // 顯示位置
                displayY: y,  // 顯示位置
                name: `星點${starCount}` 
            };
            
            coordinates.push(starData);
            
            // 創建標記點
            const marker = document.createElement('div');
            marker.className = 'star-marker';
            marker.style.left = x + 'px';
            marker.style.top = y + 'px';
            marker.dataset.id = starCount;
            imageContainer.appendChild(marker);
            
            updateCoordinatesList();
            updateConversionResults();
        });
        
        // 更新座標列表
        function updateCoordinatesList() {
            coordinatesList.innerHTML = '';
            coordinates.forEach((coord, index) => {
                const item = document.createElement('div');
                item.className = 'coordinate-item';
                item.innerHTML = `
                    <span>${coord.name}: (${coord.x}, ${coord.y})</span>
                    <button class="delete-btn" onclick="deleteCoordinate(${coord.id})">刪除</button>
                `;
                coordinatesList.appendChild(item);
            });
        }
        
        // 更新轉換結果
        function updateConversionResults() {
            if (coordinates.length === 0) {
                conversionPanel.style.display = 'none';
                return;
            }
            
            conversionPanel.style.display = 'block';
            
            // 像素座標
            pixelCoords.innerHTML = coordinates.map(coord => 
                `<div class="coord-item">${coord.name}: (${coord.x}, ${coord.y})</div>`
            ).join('');
            
            // 星座格式座標
            const starsDisplay = coordinates.map((coord, index) => {
                const xPercent = ((coord.x / imageWidth) * 100).toFixed(2);
                const yPercent = ((coord.y / imageHeight) * 100).toFixed(2);
                return `<div class="coord-item">{ x: ${xPercent}, y: ${yPercent} }, //${coord.name}</div>`;
            }).join('');
            
            const linesDisplay = coordinates.map((coord, index) => {
                const nextIndex = (index + 1) % coordinates.length;
                return `<div class="coord-item">[${index},${nextIndex}], //星點${index}連到${nextIndex}</div>`;
            }).join('');
            
            percentCoords.innerHTML = `
                <strong style="color: #4a90e2;">stars:[</strong><br>
                ${starsDisplay}
                <strong style="color: #4a90e2;">],</strong><br>
                <strong style="color: #4a90e2;">lines:[</strong><br>
                ${linesDisplay}
                <strong style="color: #4a90e2;">]</strong>
            `;
        }
        
        // 複製自定義格式（完整星座數據）
        function copyCustomFormat() {
            const starsData = coordinates.map((coord, index) => {
                const xPercent = parseFloat(((coord.x / imageWidth) * 100).toFixed(2));
                const yPercent = parseFloat(((coord.y / imageHeight) * 100).toFixed(2));
                return `    { x: ${xPercent}, y: ${yPercent} }, //${coord.name}`;
            });
            
            const linesData = coordinates.map((coord, index) => {
                const nextIndex = (index + 1) % coordinates.length;
                return `    [${index},${nextIndex}], //表示星點${index}連到${nextIndex}`;
            });
            
            const output = `// 完整星座數據結構
{
  stars: [
${starsData.join('\n')}
  ],
  lines: [
${linesData.join('\n')}
  ]
}`;
            
            navigator.clipboard.writeText(output).then(() => {
                alert('完整星座數據已複製到剪貼板！');
            });
        }
        
        // 複製像素座標
        function copyPixelCoords() {
            const pixelData = coordinates.map(coord => ({
                name: coord.name,
                x: coord.x,
                y: coord.y
            }));
            
            const output = `// 像素座標數據
const starPixelCoords = ${JSON.stringify(pixelData, null, 2)};`;
            
            navigator.clipboard.writeText(output).then(() => {
                alert('像素座標已複製到剪貼板！');
            });
        }
        
        // 複製百分比座標
        function copyPercentCoords() {
            const starsData = coordinates.map((coord, index) => {
                const xPercent = parseFloat(((coord.x / imageWidth) * 100).toFixed(2));
                const yPercent = parseFloat(((coord.y / imageHeight) * 100).toFixed(2));
                return `{ x: ${xPercent}, y: ${yPercent} }, //${coord.name}`;
            });
            
            // 生成連線數據（每個星連到下一個星，最後一個連回第一個）
            const linesData = coordinates.map((coord, index) => {
                const nextIndex = (index + 1) % coordinates.length;
                return `[${index},${nextIndex}], //表示星點${index}連到${nextIndex}`;
            });
            
            const output = `stars:[
${starsData.join('\n')}
],
lines:[
${linesData.join('\n')}
]`;
            
            navigator.clipboard.writeText(output).then(() => {
                alert('星座格式數據已複製到剪貼板！');
            });
        }
        
        // 複製 CSS 代碼
        function copyCSSCode() {
            const cssCode = coordinates.map(coord => {
                const xPercent = ((coord.x / imageWidth) * 100).toFixed(2);
                const yPercent = ((coord.y / imageHeight) * 100).toFixed(2);
                const className = coord.name.toLowerCase().replace('星點', 'star');
                return `.${className} {
  position: absolute;
  left: ${xPercent}%;
  top: ${yPercent}%;
  transform: translate(-50%, -50%);
}`;
            }).join('\n\n');
            
            const fullCSS = `/* 星座容器 */
.constellation-container {
  position: relative;
  width: 100%;
  display: inline-block;
}

/* 星點樣式 */
.star-point {
  position: absolute;
  width: 8px;
  height: 8px;
  background: white;
  border-radius: 50%;
  box-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
}

/* 各星點位置 */
${cssCode}`;
            
            navigator.clipboard.writeText(fullCSS).then(() => {
                alert('CSS 代碼已複製到剪貼板！');
            });
        }
        
        // 複製 JavaScript 代碼
        function copyJavaScriptCode() {
            const percentData = coordinates.map(coord => {
                const xPercent = parseFloat(((coord.x / imageWidth) * 100).toFixed(2));
                const yPercent = parseFloat(((coord.y / imageHeight) * 100).toFixed(2));
                return {
                    name: coord.name,
                    x: xPercent,
                    y: yPercent
                };
            });
            
            const jsCode = `// 響應式星點定位系統
const starCoordinates = ${JSON.stringify(percentData, null, 2)};

// 動態定位函數
function positionStars() {
  const container = document.querySelector('.constellation-container');
  const img = container.querySelector('img');
  const imgRect = img.getBoundingClientRect();
  
  starCoordinates.forEach((star, index) => {
    const starElement = container.querySelector(\`.star\${index + 1}\`);
    if (starElement) {
      starElement.style.left = \`\${star.x}%\`;
      starElement.style.top = \`\${star.y}%\`;
    }
  });
}

// 監聽視窗大小改變
window.addEventListener('resize', positionStars);

// Vue.js 使用方式
// const starData = ref(${JSON.stringify(percentData, null, 2)});`;
            
            navigator.clipboard.writeText(jsCode).then(() => {
                alert('JavaScript 代碼已複製到剪貼板！');
            });
        }
        
        // 刪除座標點
        function deleteCoordinate(id) {
            coordinates = coordinates.filter(coord => coord.id !== id);
            const marker = document.querySelector(`[data-id="${id}"]`);
            if (marker) marker.remove();
            updateCoordinatesList();
            updateConversionResults();
        }
        
        // 導出座標
        exportBtn.addEventListener('click', () => {
            const result = coordinates.map(coord => {
                const xPercent = parseFloat(((coord.x / imageWidth) * 100).toFixed(2));
                const yPercent = parseFloat(((coord.y / imageHeight) * 100).toFixed(2));
                return {
                    name: coord.name,
                    pixelX: coord.x,
                    pixelY: coord.y,
                    percentX: xPercent,
                    percentY: yPercent
                };
            });
            
            const output = `// 完整星點數據
const constellationStars = ${JSON.stringify(result, null, 2)};

// 圖片尺寸信息
const imageSize = {
  width: ${imageWidth},
  height: ${imageHeight}
};`;
            
            navigator.clipboard.writeText(output).then(() => {
                alert('完整座標數據已複製到剪貼板！');
            });
        });
        
        // 清除全部座標
        clearBtn.addEventListener('click', () => {
            if (confirm('確定要清除所有座標點嗎？')) {
                coordinates = [];
                starCount = 0;
                document.querySelectorAll('.star-marker').forEach(marker => marker.remove());
                updateCoordinatesList();
                updateConversionResults();
            }
        });
    </script>
</body>
</html>
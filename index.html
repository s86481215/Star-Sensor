<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜Ÿé»åº§æ¨™æ¸¬é‡å·¥å…·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a2e;
            color: white;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .upload-area {
            border: 2px dashed #4a90e2;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .upload-area:hover {
            background-color: rgba(74, 144, 226, 0.1);
        }
        
        .image-container {
            position: relative;
            display: inline-block;
            margin-bottom: 20px;
        }
        
        .constellation-image {
            max-width: 100%;
            border: 1px solid #444;
            cursor: crosshair;
        }
        
        .star-marker {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #ff6b6b;
            border: 2px solid white;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            cursor: pointer;
        }
        
        .coordinates-panel {
            background: #2d2d44;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .coordinate-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #444;
        }
        
        .coordinate-item:last-child {
            border-bottom: none;
        }
        
        .delete-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .delete-btn:hover {
            background: #c0392b;
        }
        
        .export-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .export-btn:hover {
            background: #219a52;
        }
        
        .instructions {
            background: #2d2d44;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .clear-btn {
            background: #f39c12;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
            margin-left: 10px;
        }
        
        .clear-btn:hover {
            background: #e67e22;
        }
        
        .conversion-panel {
            background: #2d2d44;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            border: 2px solid #4a90e2;
        }
        
        .coordinate-display {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }
        
        .coord-section {
            background: #1a1a2e;
            padding: 15px;
            border-radius: 8px;
        }
        
        .coord-section h4 {
            margin-top: 0;
            color: #4a90e2;
        }
        
        .coord-item {
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin: 5px 0;
            padding: 5px;
            background: rgba(74, 144, 226, 0.1);
            border-radius: 4px;
        }
        
        .image-info {
            background: #2d2d44;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            text-align: center;
        }
        
        .copy-btn {
            background: #8e44ad;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 12px;
        }
        
        .copy-btn:hover {
            background: #732d91;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒŸ æ˜Ÿé»åº§æ¨™æ¸¬é‡å·¥å…·</h1>
        
        <div class="instructions">
            <h3>ä½¿ç”¨æ–¹æ³•ï¼š</h3>
            <ol>
                <li>é»æ“Šä¸‹æ–¹å€åŸŸä¸Šå‚³ä½ çš„æ˜Ÿåº§ PNG åœ–ç‰‡</li>
                <li>åœ¨åœ–ç‰‡ä¸Šé»æ“Šæ¯å€‹æ˜Ÿæ˜Ÿçš„ä½ç½®</li>
                <li>åº§æ¨™æœƒè‡ªå‹•è¨˜éŒ„åœ¨ä¸‹æ–¹</li>
                <li>é»æ“Šã€Œå°å‡ºåº§æ¨™ã€è¤‡è£½çµæœ</li>
            </ol>
        </div>
        
        <div class="upload-area" id="uploadArea">
            <p>ğŸ“é»æ“Šé€™è£¡ä¸Šå‚³æ˜Ÿåº§åœ–ç‰‡ (PNG, JPG, GIF)</p>
            <input type="file" id="imageInput" accept="image/*" style="display: none;">
        </div>
        
        <div id="imageContainer" class="image-container" style="display: none;">
            <img id="constellationImage" class="constellation-image">
        </div>
        
        <div class="coordinates-panel">
            <h3>ğŸ“ æ˜Ÿé»åº§æ¨™è¨˜éŒ„ï¼š</h3>
            <div id="coordinatesList"></div>
            <button class="export-btn" id="exportBtn">å°å‡ºåº§æ¨™</button>
            <button class="clear-btn" id="clearBtn">æ¸…é™¤æ‰€æœ‰</button>
        </div>
        
        <div class="conversion-panel" id="conversionPanel" style="display: none;">
            <h3>ğŸ”„ åº§æ¨™è½‰æ›çµæœ</h3>
            <div class="image-info" id="imageInfo"></div>
            <div class="coordinate-display">
                <div class="coord-section">
                    <h4>ğŸ“ åƒç´ åº§æ¨™ (px)</h4>
                    <div id="pixelCoords"></div>
                    <button class="copy-btn" onclick="copyPixelCoords()">è¤‡è£½åƒç´ åº§æ¨™</button>
                </div>
                <div class="coord-section">
                    <h4>ğŸ“Š æ˜Ÿåº§æ ¼å¼æ•¸æ“š</h4>
                    <div id="percentCoords"></div>
                    <button class="copy-btn" onclick="copyPercentCoords()">è¤‡è£½æ˜Ÿåº§æ ¼å¼</button>
                </div>
            </div>
            <div style="margin-top: 20px;">
                <button class="copy-btn" onclick="copyCustomFormat()" style="background: #e67e22;">è¤‡è£½å®Œæ•´æ˜Ÿåº§æ•¸æ“š</button>
                <button class="copy-btn" onclick="copyCSSCode()" style="background: #27ae60;">è¤‡è£½ CSS ä»£ç¢¼</button>
                <button class="copy-btn" onclick="copyJavaScriptCode()" style="background: #f1c40f; color: #2c3e50;">è¤‡è£½ JavaScript ä»£ç¢¼</button>
            </div>
        </div>
    </div>

    <script>
        let starCount = 0;
        let coordinates = [];
        let imageWidth = 0;
        let imageHeight = 0;
        
        const uploadArea = document.getElementById('uploadArea');
        const imageInput = document.getElementById('imageInput');
        const imageContainer = document.getElementById('imageContainer');
        const constellationImage = document.getElementById('constellationImage');
        const coordinatesList = document.getElementById('coordinatesList');
        const exportBtn = document.getElementById('exportBtn');
        const clearBtn = document.getElementById('clearBtn');
        const conversionPanel = document.getElementById('conversionPanel');
        const imageInfo = document.getElementById('imageInfo');
        const pixelCoords = document.getElementById('pixelCoords');
        const percentCoords = document.getElementById('percentCoords');
        
        // é»æ“Šä¸Šå‚³å€åŸŸ
        uploadArea.addEventListener('click', () => {
            imageInput.click();
        });
        
        // è™•ç†æ–‡ä»¶ä¸Šå‚³
        imageInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    constellationImage.src = e.target.result;
                    imageContainer.style.display = 'inline-block';
                    uploadArea.style.display = 'none';
                    
                    // ç²å–åœ–ç‰‡å°ºå¯¸
                    constellationImage.onload = () => {
                        imageWidth = constellationImage.naturalWidth;
                        imageHeight = constellationImage.naturalHeight;
                        updateImageInfo();
                    };
                };
                reader.readAsDataURL(file);
            }
        });
        
        // æ›´æ–°åœ–ç‰‡ä¿¡æ¯
        function updateImageInfo() {
            imageInfo.innerHTML = `
                <strong>åœ–ç‰‡å°ºå¯¸ï¼š</strong> ${imageWidth} Ã— ${imageHeight} åƒç´ <br>
                <small>åº§æ¨™å°‡è‡ªå‹•è½‰æ›ç‚ºç›¸å°ç™¾åˆ†æ¯”ï¼Œé©æ‡‰ä»»ä½•å°ºå¯¸é¡¯ç¤º</small>
            `;
        }
        
        // é»æ“Šåœ–ç‰‡è¨˜éŒ„åº§æ¨™
        constellationImage.addEventListener('click', (e) => {
            const rect = constellationImage.getBoundingClientRect();
            const x = Math.round(e.clientX - rect.left);
            const y = Math.round(e.clientY - rect.top);
            
            // è¨ˆç®—å¯¦éš›åƒç´ åº§æ¨™ï¼ˆåŸºæ–¼åŸåœ–å°ºå¯¸ï¼‰
            const actualX = Math.round((x / rect.width) * imageWidth);
            const actualY = Math.round((y / rect.height) * imageHeight);
            
            starCount++;
            const starData = { 
                id: starCount, 
                x: actualX, 
                y: actualY, 
                displayX: x,  // é¡¯ç¤ºä½ç½®
                displayY: y,  // é¡¯ç¤ºä½ç½®
                name: `æ˜Ÿé»${starCount}` 
            };
            
            coordinates.push(starData);
            
            // å‰µå»ºæ¨™è¨˜é»
            const marker = document.createElement('div');
            marker.className = 'star-marker';
            marker.style.left = x + 'px';
            marker.style.top = y + 'px';
            marker.dataset.id = starCount;
            imageContainer.appendChild(marker);
            
            updateCoordinatesList();
            updateConversionResults();
        });
        
        // æ›´æ–°åº§æ¨™åˆ—è¡¨
        function updateCoordinatesList() {
            coordinatesList.innerHTML = '';
            coordinates.forEach((coord, index) => {
                const item = document.createElement('div');
                item.className = 'coordinate-item';
                item.innerHTML = `
                    <span>${coord.name}: (${coord.x}, ${coord.y})</span>
                    <button class="delete-btn" onclick="deleteCoordinate(${coord.id})">åˆªé™¤</button>
                `;
                coordinatesList.appendChild(item);
            });
        }
        
        // æ›´æ–°è½‰æ›çµæœ
        function updateConversionResults() {
            if (coordinates.length === 0) {
                conversionPanel.style.display = 'none';
                return;
            }
            
            conversionPanel.style.display = 'block';
            
            // åƒç´ åº§æ¨™
            pixelCoords.innerHTML = coordinates.map(coord => 
                `<div class="coord-item">${coord.name}: (${coord.x}, ${coord.y})</div>`
            ).join('');
            
            // æ˜Ÿåº§æ ¼å¼åº§æ¨™
            const starsDisplay = coordinates.map((coord, index) => {
                const xPercent = ((coord.x / imageWidth) * 100).toFixed(2);
                const yPercent = ((coord.y / imageHeight) * 100).toFixed(2);
                return `<div class="coord-item">{ x: ${xPercent}, y: ${yPercent} }, //${coord.name}</div>`;
            }).join('');
            
            const linesDisplay = coordinates.map((coord, index) => {
                const nextIndex = (index + 1) % coordinates.length;
                return `<div class="coord-item">[${index},${nextIndex}], //æ˜Ÿé»${index}é€£åˆ°${nextIndex}</div>`;
            }).join('');
            
            percentCoords.innerHTML = `
                <strong style="color: #4a90e2;">stars:[</strong><br>
                ${starsDisplay}
                <strong style="color: #4a90e2;">],</strong><br>
                <strong style="color: #4a90e2;">lines:[</strong><br>
                ${linesDisplay}
                <strong style="color: #4a90e2;">]</strong>
            `;
        }
        
        // è¤‡è£½è‡ªå®šç¾©æ ¼å¼ï¼ˆå®Œæ•´æ˜Ÿåº§æ•¸æ“šï¼‰
        function copyCustomFormat() {
            const starsData = coordinates.map((coord, index) => {
                const xPercent = parseFloat(((coord.x / imageWidth) * 100).toFixed(2));
                const yPercent = parseFloat(((coord.y / imageHeight) * 100).toFixed(2));
                return `    { x: ${xPercent}, y: ${yPercent} }, //${coord.name}`;
            });
            
            const linesData = coordinates.map((coord, index) => {
                const nextIndex = (index + 1) % coordinates.length;
                return `    [${index},${nextIndex}], //è¡¨ç¤ºæ˜Ÿé»${index}é€£åˆ°${nextIndex}`;
            });
            
            const output = `// å®Œæ•´æ˜Ÿåº§æ•¸æ“šçµæ§‹
{
  stars: [
${starsData.join('\n')}
  ],
  lines: [
${linesData.join('\n')}
  ]
}`;
            
            navigator.clipboard.writeText(output).then(() => {
                alert('å®Œæ•´æ˜Ÿåº§æ•¸æ“šå·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼');
            });
        }
        
        // è¤‡è£½åƒç´ åº§æ¨™
        function copyPixelCoords() {
            const pixelData = coordinates.map(coord => ({
                name: coord.name,
                x: coord.x,
                y: coord.y
            }));
            
            const output = `// åƒç´ åº§æ¨™æ•¸æ“š
const starPixelCoords = ${JSON.stringify(pixelData, null, 2)};`;
            
            navigator.clipboard.writeText(output).then(() => {
                alert('åƒç´ åº§æ¨™å·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼');
            });
        }
        
        // è¤‡è£½ç™¾åˆ†æ¯”åº§æ¨™
        function copyPercentCoords() {
            const starsData = coordinates.map((coord, index) => {
                const xPercent = parseFloat(((coord.x / imageWidth) * 100).toFixed(2));
                const yPercent = parseFloat(((coord.y / imageHeight) * 100).toFixed(2));
                return `{ x: ${xPercent}, y: ${yPercent} }, //${coord.name}`;
            });
            
            // ç”Ÿæˆé€£ç·šæ•¸æ“šï¼ˆæ¯å€‹æ˜Ÿé€£åˆ°ä¸‹ä¸€å€‹æ˜Ÿï¼Œæœ€å¾Œä¸€å€‹é€£å›ç¬¬ä¸€å€‹ï¼‰
            const linesData = coordinates.map((coord, index) => {
                const nextIndex = (index + 1) % coordinates.length;
                return `[${index},${nextIndex}], //è¡¨ç¤ºæ˜Ÿé»${index}é€£åˆ°${nextIndex}`;
            });
            
            const output = `stars:[
${starsData.join('\n')}
],
lines:[
${linesData.join('\n')}
]`;
            
            navigator.clipboard.writeText(output).then(() => {
                alert('æ˜Ÿåº§æ ¼å¼æ•¸æ“šå·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼');
            });
        }
        
        // è¤‡è£½ CSS ä»£ç¢¼
        function copyCSSCode() {
            const cssCode = coordinates.map(coord => {
                const xPercent = ((coord.x / imageWidth) * 100).toFixed(2);
                const yPercent = ((coord.y / imageHeight) * 100).toFixed(2);
                const className = coord.name.toLowerCase().replace('æ˜Ÿé»', 'star');
                return `.${className} {
  position: absolute;
  left: ${xPercent}%;
  top: ${yPercent}%;
  transform: translate(-50%, -50%);
}`;
            }).join('\n\n');
            
            const fullCSS = `/* æ˜Ÿåº§å®¹å™¨ */
.constellation-container {
  position: relative;
  width: 100%;
  display: inline-block;
}

/* æ˜Ÿé»æ¨£å¼ */
.star-point {
  position: absolute;
  width: 8px;
  height: 8px;
  background: white;
  border-radius: 50%;
  box-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
}

/* å„æ˜Ÿé»ä½ç½® */
${cssCode}`;
            
            navigator.clipboard.writeText(fullCSS).then(() => {
                alert('CSS ä»£ç¢¼å·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼');
            });
        }
        
        // è¤‡è£½ JavaScript ä»£ç¢¼
        function copyJavaScriptCode() {
            const percentData = coordinates.map(coord => {
                const xPercent = parseFloat(((coord.x / imageWidth) * 100).toFixed(2));
                const yPercent = parseFloat(((coord.y / imageHeight) * 100).toFixed(2));
                return {
                    name: coord.name,
                    x: xPercent,
                    y: yPercent
                };
            });
            
            const jsCode = `// éŸ¿æ‡‰å¼æ˜Ÿé»å®šä½ç³»çµ±
const starCoordinates = ${JSON.stringify(percentData, null, 2)};

// å‹•æ…‹å®šä½å‡½æ•¸
function positionStars() {
  const container = document.querySelector('.constellation-container');
  const img = container.querySelector('img');
  const imgRect = img.getBoundingClientRect();
  
  starCoordinates.forEach((star, index) => {
    const starElement = container.querySelector(\`.star\${index + 1}\`);
    if (starElement) {
      starElement.style.left = \`\${star.x}%\`;
      starElement.style.top = \`\${star.y}%\`;
    }
  });
}

// ç›£è½è¦–çª—å¤§å°æ”¹è®Š
window.addEventListener('resize', positionStars);

// Vue.js ä½¿ç”¨æ–¹å¼
// const starData = ref(${JSON.stringify(percentData, null, 2)});`;
            
            navigator.clipboard.writeText(jsCode).then(() => {
                alert('JavaScript ä»£ç¢¼å·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼');
            });
        }
        
        // åˆªé™¤åº§æ¨™é»
        function deleteCoordinate(id) {
            coordinates = coordinates.filter(coord => coord.id !== id);
            const marker = document.querySelector(`[data-id="${id}"]`);
            if (marker) marker.remove();
            updateCoordinatesList();
            updateConversionResults();
        }
        
        // å°å‡ºåº§æ¨™
        exportBtn.addEventListener('click', () => {
            const result = coordinates.map(coord => {
                const xPercent = parseFloat(((coord.x / imageWidth) * 100).toFixed(2));
                const yPercent = parseFloat(((coord.y / imageHeight) * 100).toFixed(2));
                return {
                    name: coord.name,
                    pixelX: coord.x,
                    pixelY: coord.y,
                    percentX: xPercent,
                    percentY: yPercent
                };
            });
            
            const output = `// å®Œæ•´æ˜Ÿé»æ•¸æ“š
const constellationStars = ${JSON.stringify(result, null, 2)};

// åœ–ç‰‡å°ºå¯¸ä¿¡æ¯
const imageSize = {
  width: ${imageWidth},
  height: ${imageHeight}
};`;
            
            navigator.clipboard.writeText(output).then(() => {
                alert('å®Œæ•´åº§æ¨™æ•¸æ“šå·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼');
            });
        });
        
        // æ¸…é™¤å…¨éƒ¨åº§æ¨™
        clearBtn.addEventListener('click', () => {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰åº§æ¨™é»å—ï¼Ÿ')) {
                coordinates = [];
                starCount = 0;
                document.querySelectorAll('.star-marker').forEach(marker => marker.remove());
                updateCoordinatesList();
                updateConversionResults();
            }
        });
    </script>
</body>
</html>